<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
   
 <!--   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
   -->
 <!--   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"> 
 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.css">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.js'></script>
    



    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
    

    <link rel="stylesheet" href="style.css" type="text/css">


    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.css">

    <style type="text/css">
    

    </style>

<!-- <script src="/bower_components/socket.io-client/socket.io.js"></script> -->


  </head>


 <body>
    <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
      <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#">msgx</a>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Live Logs</a>
          </li>
           <li class="nav-item">
            <a class="nav-link" href="/todo">todo (dev)</a>
          </li>
        </ul>
        <form class="form-inline mt-2 mt-md-0">
     <!--     <input class="form-control mr-sm-2" type="text" placeholder="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->
        </form>
      </div>
    </nav>

    


<main class="col-sm-10 offset-sm-1 col-md-10  pt-3">
         
  <div class="container">
    <br>
    <br>
      <h1>
       msgx 
      </h1>
  </div>
 </div>

<!--   SPACE MAKER v1.0 -->
<div class="col-xs-12" style="height:50px;"></div>


 <div class="features-boxed">
        <div class="container">
            <div class="intro">
             <!--   <h2 class="text-center">Features </h2> -->
             <!--   <p class="text-center">Nunc luctus in metus eget fringilla. Aliquam sed justo ligula. Vestibulum nibh erat, pellentesque ut laoreet vitae.</p> -->
            </div>
            <div class="row features">
                <div class="col-md-3 col-sm-6 item">
                    <div class="box monitors">
                        <div id="counterBig"></div> 
                        <h5 class="name">Messages</h5><a href="#" class="learn-more">Learn more »</a></div>
                </div>
                <div class="col-md-3 col-sm-6 item">
                    <div class="box monitors">
                     <!--   <div id="percentStatus"></div> -->
                        <h3 class="monitorGreen">97%</h3>
                        <div id="monitor2"></div> 
                        <h5 class="name">Backup in 24h</h5><a href="#" class="learn-more">Learn more »</a></div>
                </div>
                <div class="col-md-3 col-sm-6 item">
                    <div class="box monitors">
                        <h3 class="monitorGreen">34</h3>
                        <div id="monitor3"></div> 
                        <h5 class="name">Clients</h5><a href="#" class="learn-more">Learn more »</a></div>
                </div>
                <div class="col-md-3 col-sm-6 item">
                    <div class="box monitors">
                        <h3 class="monitorGreen">11</h3>
                        <div id="monitor4"></div> 
                        <h5 class="name">Requests</h5><a href="#" class="learn-more">Learn more »</a></div>
                </div>
            </div>
        </div>
    </div>



<!--   SPACE MAKER v1.0 -->
<div class="col-xs-12" style="height:50px;"></div>


<!-- Timeline -->

  <div class="container headline">

      <h3>Timeline</h3>

  </div>


<!--   SPACE MAKER  -->
<div class="col-xs-12" style="height:25px;"></div>


<!-- vis.js timeline <div> -->
<div id="visualization" class="container "></div>



<!--   SPACE MAKER  -->
<div class="col-xs-12" style="height:50px;"></div>



<!-- dashboard: real time stats  -->

<!--   SPACE MAKER  -->
<div class="col-xs-12" style="height:50px;"></div>

<div id="logline" class="container headline">
  <h3>Last sync:</h3>
  <div id="logline1"></div>
</div>

<!--   SPACE MAKER  -->
<div class="col-xs-12" style="height:50px;"></div>

 <!-- container  -->


    <div class="container headline">
      <h3>Status:</h3> 
    </div>

    <!--   SPACE MAKER  -->
    <div class="col-xs-12" style="height:50px;"></div>

    <div class="container">
           <div id = "clientList" class = "col-lg-12 text-center "></div> 
    </div>
   

<!--   SPACE MAKER  -->
<div class="col-xs-12" style="height:50px;"></div>
  

<!-- client status cards   -->



</div>

<div id="clientListclient"></div>


<p>
 
</p>
<div id="msgCnt" style="background-color: #0066ff; color: white; " >
</div>




</div>


<div>
  

      
      </div>
    </div>


    <!-- jQuery first, then Tether, then Bootstrap JS. -->


   



  </body>

<script>
var socket = io.connect('http://localhost:3020');

$(document).ready(function () {
    console.log("warming up...");

    // clientLit



    $.getJSON("http://localhost:3000/clientlist", function (data) {
        console.log("got JSON");

        var length = data.length;

        var logo_path = '/connecting.gif';
        var client_logo = "<img src=" + logo_path + ">";
       

        for(var i = 0; i < length; i++){
          $.each(data[i], function (key, obj) {
              console.log(key, obj)
              var client_placeholder = "<br><br>" + client_logo + "<br>" +  "<br><h5 class=\"card-title\"><a href=" + "\"/details/"  + obj +"\">" + obj + " </h4></a><br><br><br><br></div>" ;
              $('<div />', {
                id: key + "-" + obj,
                html: client_placeholder,
                style: "background-color: white; ",
                class: "x_panel col-xs-6 col-sm-6 col-lg-3"
              }).appendTo('#clientList')       
          }); 
        }
    }); 
});

// MONITORI counteri

socket.on('monitor2', function (msg) {
    console.log("Connected to monitor2")
    console.log(msg);
      //$('#logline1').prepend($('<tr>').text(msg));
      var returnString = (msg)
      var jsondata = $.parseJSON(returnString);

      
        $('#monitor2').empty().append($('<h3 class="monitorGreen">').html(jsondata));
      

       
    
});



 $.getJSON( "http://localhost:3000/clientCount", function( data1 ) {
      var items = [];
      $.each( data1, function( key, val ) {
         items.push( "<h4>Total clients on watch: " + val + "</h4>" );
      });
 
      $( "<p/>", {
         "class": "h1",
            html: items.join( "**" )
              }).appendTo( "#counter" );
});



// TIMEINE 

 $.getJSON( "http://localhost:3000/timeline", function( data ) {
      var items = [];
      $.each( data, function( key, val ) {
         items.push( "<h4>Total clients on watch: " + val + "</h4>" );
      });

      // DOM element where the Timeline will be attached
      //var container = $('visualization')
      var container = document.getElementById('visualization');

      //var container = $('visualization').append();

      // Create a DataSet (allows two way data-binding)
      var items = new vis.DataSet([
        {id: 1, content: 'Intertekstil-Stanic', start: '2014-04-20 08:00'},
        {id: 2, content: 'Sinitech', start: '2014-04-14 11:23'},
        {id: 3, content: 'Hanfa', start: '2014-04-19'},
        {id: 4, content: 'Sinitech', start: '2014-04-13'},
        {id: 5, content: 'Hanfa', start: '2014-04-18'},
        {id: 6, content: 'Sinitech', start: '2014-04-12'},
        {id: 7, content: 'Hanfa', start: '2014-04-18'},
        {id: 8, content: 'Geoprojekt', start: '2014-04-11', end: '2014-04-19'},
        {id: 9, content: 'Tehnokom', start: '2014-04-28'},
        {id: 10, content: 'Medicline', start: '2014-04-27', type: 'point'}
      ]);
      // Configuration for the Timeline
      var options = {
        // Set global item type. Type can also be specified for items individually
        // Available types: 'box' (default), 'point', 'range'
        type: 'point',
        showMajorLabels: false,
        width: '100%',
        height: '240px'
      };

      // Create a Timeline
      var timeline = new vis.Timeline(container, items, options);
});





socket.on('logline', function (msg) {
    console.log("Connected to")
    console.log(msg);
      //$('#logline1').prepend($('<tr>').text(msg));
      var returnString = (msg)
      var jsondata = $.parseJSON(returnString);

      // poveži json i variable 
      id = jsondata.id;
      client = "<a href=" + "\"/details/"  + jsondata.client +"\">" + jsondata.client + " </a>" ;
      service = jsondata.service;
      status = jsondata.status;
      datetime = jsondata.datetime;


      $('#counterBig').empty().append($('<h3 class="monitorGreen">').html(id));
    
    var markdown = "";
    var sicon = "";
    var status_icon_align = "middle";

    clientDiv = '#client'+'-'+jsondata.client;
    $(clientDiv).empty();

     if (status == "completed") {
        var sicon = "/success-icon.png"
      } else if (status = "started") {
        var sicon = "/started.png";
      } else {
        var sicon = "/question.png"
      }
      status_icon = "<img src=" + sicon + " align=" + status_icon_align + " >";
      $(clientDiv).append($('<br><br><div style="width: 100%; margin: 0 auto;">').html(status_icon ));


    // $(clientDiv).append($('<span style="background-color: #00ff33; width: 100%; margin 5px auto;">').html("---------")); 
    
      $(clientDiv).append($('<br>'));
      $(clientDiv).append($('<h5 class="card-title white-text">').html(client));
     
      $(clientDiv).append($('<h6 style="color:#006600" class="card-title"><b>').html(service));
      $(clientDiv).append($('<h6 style="color:#006699">').html(status));
      $(clientDiv).append($('<em>').html(datetime + "</p>"));

 
      $(clientDiv).append($('<br>'));

  
  //  $(clientDiv).append($('<em>').html("Service "  + "<b>"+service+"</b>"));

   
   // $(clientDiv).append($('<p>').text("ic:" +markdown);

});

socket.on('percentStatus', function (msg) {
    console.log("Connected to")
    console.log(msg);
      //$('#logline1').prepend($('<tr>').text(msg));
      var returnString = (msg)
      var jsondata = $.parseJSON(returnString);

        for (key in jsondata) {
        if (jsondata[key] = "\"t\"") {
         var percentStatus = jsondata;
         console.log("ovo je poslano na clienta: " + percentStatus)

        $('#percentStatus').empty().append($('<h2>').html(percentStatus));
       }


       }
    
});






</script>


<script type="text/javascript">

// DOM element where the Timeline will be attached
  //var container = $('visualization')
  var container = document.getElementById('visualization');

  //var container = $('visualization').append();

  // Create a DataSet (allows two way data-binding)
  var items = new vis.DataSet([
    {id: 1, content: 'Intertekstil-Stanic', start: '2014-04-20 08:00'},
    {id: 2, content: 'Sinitech', start: '2014-04-14 11:23'},
    {id: 3, content: 'Hanfa', start: '2014-04-19'},
    {id: 4, content: 'Sinitech', start: '2014-04-13'},
    {id: 5, content: 'Hanfa', start: '2014-04-18'},
    {id: 6, content: 'Sinitech', start: '2014-04-12'},
    {id: 7, content: 'Hanfa', start: '2014-04-18'},
    {id: 8, content: 'Geoprojekt', start: '2014-04-11', end: '2014-04-19'},
    {id: 9, content: 'Tehnokom', start: '2014-04-28'},
    {id: 10, content: 'Medicline', start: '2014-04-27', type: 'point'}
  ]);
  // Configuration for the Timeline
  var options = {
    // Set global item type. Type can also be specified for items individually
    // Available types: 'box' (default), 'point', 'range'
    type: 'point',
    showMajorLabels: false,
    width: '100%',
    height: '240px'
  };

  // Create a Timeline
  var timeline = new vis.Timeline(container, items, options);

</script>


</html>